@{
    ViewBag.Title = "All Groups";
}

<h2>@ViewBag.Title</h2>
<br />

@if (TempData.ContainsKey("message"))
{
    <div class="alert alert-info">@TempData["message"]</div>
}

<br />

<div class="container">
    @if (ViewBag.Groups != null && ((List<Connectify.Models.Group>)ViewBag.Groups).Any())
    {
        @foreach (var group in (List<Connectify.Models.Group>)ViewBag.Groups)
        {
            // Verificăm dacă utilizatorul este deja parte din grup
            var isUserInGroup = ((List<int>)ViewBag.UserGroups).Contains(group.Id);

            <div class="card mb-3 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">@group.GroupName</h5>

                    @if (!string.IsNullOrEmpty(group.Description))
                    {
                        <p class="card-text">@group.Description</p>
                    }
                    else
                    {
                        <p class="text-muted">No description available.</p>
                    }

                    @if (isUserInGroup)
                    {
                        <!-- Buton pentru a vedea conținutul grupului dacă utilizatorul este membru -->
                        <a href="@Url.Action("Show", "Groups", new { id = group.Id })" class="btn btn-primary">See Group Content</a>
                    }
                    else
                    {
                        <!-- Formular pentru alăturarea la grup dacă utilizatorul nu este membru -->
                        <form asp-action="JoinGroup" asp-controller="Groups" method="post">
                            <input type="hidden" name="id" value="@group.Id" />
                            <button type="submit" class="btn btn-success">Join Group</button>
                        </form>
                    }
                </div>
            </div>
        }
    }
    else
    {
        <p>No groups available at the moment.</p>
    }
</div>

<div class="text-center mt-4">
    <a href="@Url.Action("New", "Groups")" class="btn btn-lg btn-outline-primary">Create a New Group</a>
</div>
